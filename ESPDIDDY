local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

local isLocking = false

-- Find player with head closest to center of screen
local function getClosestToCrosshair()
	local closestPlayer = nil
	local smallestDistance = math.huge
	local screenCenter = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)

	for _, player in ipairs(Players:GetPlayers()) do
		if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("Head") then
			local head = player.Character.Head
			local screenPos, onScreen = Camera:WorldToViewportPoint(head.Position)

			if onScreen then
				local screenPos2D = Vector2.new(screenPos.X, screenPos.Y)
				local distance = (screenPos2D - screenCenter).Magnitude

				if distance < smallestDistance then
					smallestDistance = distance
					closestPlayer = player
				end
			end
		end
	end

	return closestPlayer
end

-- Lock camera to target head
RunService.RenderStepped:Connect(function()
	if isLocking then
		local target = getClosestToCrosshair()
		if target and target.Character and target.Character:FindFirstChild("Head") then
			local head = target.Character.Head
			Camera.CFrame = CFrame.new(Camera.CFrame.Position, head.Position)
		end
	end
end)

-- Toggle on key press
UserInputService.InputBegan:Connect(function(input, gameProcessed)
	if not gameProcessed and input.KeyCode == Enum.KeyCode.E then
		isLocking = true
	end
end)

UserInputService.InputEnded:Connect(function(input, gameProcessed)
	if input.KeyCode == Enum.KeyCode.E then
		isLocking = false
	end
end)
